{% extends "base.html" %}
{% from "components/input.html" import text_input, textarea_input %}

{% block title %}New Audit | {{ app_name }}{% endblock %}

{% block content %}
<section class="hero compact">
  <h1>Create New Client Audit</h1>
  <p>Submit a channel URL to queue a full audit pipeline and track progress from this workspace.</p>
</section>

<section class="panel form-panel">
  <form method="post" action="{{ url_for('pages.create_audit') }}" class="form-grid" x-data="{ limitCrawl: false, maxVideos: 50 }">
    {{ text_input('client_name', 'Client Name', required=True, placeholder='Acme Corp') }}
    {{ text_input('client_contact', 'Client Contact (Optional)', placeholder='name@client.com') }}
    {{ text_input('channel_url', 'YouTube Channel URL', input_type='url', required=True, placeholder='https://youtube.com/@channelname', help_text='Supported: @handle, /channel/UC..., /c/..., /user/...') }}
    {{ textarea_input('notes', 'Internal Notes', placeholder='Delivery context, timeline, campaign notes...') }}

    <fieldset class="crawl-scope-panel">
      <legend class="field-label">Crawl Scope</legend>
      <input type="hidden" name="crawl_scope" :value="limitCrawl ? 'limited' : 'all'">

      <label class="checkbox-row" for="limit_crawl">
        <input id="limit_crawl" name="limit_crawl" type="checkbox" value="1" x-model="limitCrawl">
        <span>Limit crawl to top videos by views</span>
      </label>

      <div class="inline-input-group" x-show="limitCrawl" x-cloak>
        <label class="field-label" for="max_videos">Top Videos Limit</label>
        <input
          id="max_videos"
          name="max_videos"
          type="number"
          min="1"
          max="5000"
          step="1"
          class="field-input"
          x-model.number="maxVideos"
          :disabled="!limitCrawl"
          :required="limitCrawl"
        >
        <div class="quick-pills">
          <button type="button" class="btn btn-ghost btn-chip" @click="maxVideos = 50">50</button>
          <button type="button" class="btn btn-ghost btn-chip" @click="maxVideos = 100">100</button>
          <button type="button" class="btn btn-ghost btn-chip" @click="maxVideos = 250">250</button>
        </div>
      </div>

      <p class="field-help" x-show="!limitCrawl">Default is full crawl of all channel videos.</p>
      <p class="field-help" x-show="limitCrawl">Limited mode fetches the top N videos by view count.</p>
    </fieldset>

    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Queue Audit</button>
      <a href="{{ url_for('pages.dashboard') }}" class="btn btn-ghost">Cancel</a>
    </div>
  </form>
</section>
{% endblock %}
